<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<TITLE>
    CWG Issue 2552</TITLE>
<STYLE TYPE="text/css">
  INS { text-decoration:none; font-weight:bold; background-color:#A0FFA0 }
  .INS { text-decoration:none; background-color:#D0FFD0 }
  DEL { text-decoration:line-through; background-color:#FFA0A0 }
  SPAN.cmnt { font-family:Times; font-style:italic }
</STYLE>
</HEAD>
<BODY>
<P><EM>This is an unofficial snapshot of the ISO/IEC JTC1 SC22 WG21
  Core Issues List revision 111d.
  See http://www.open-std.org/jtc1/sc22/wg21/ for the official
  list.</EM></P>
<P>2023-05-12</P>
<HR>
<A NAME="2552"></A><H4>2552.
  
Constant evaluation of non-defining variable declarations
</H4>
<B>Section: </B>7.7&#160; [<A href="https://wg21.link/expr.const">expr.const</A>]
 &#160;&#160;&#160;

 <B>Status: </B>open
 &#160;&#160;&#160;

 <B>Submitter: </B>Hubert Tong
 &#160;&#160;&#160;

 <B>Date: </B>2022-03-21<BR>


<P>Paper
<A HREF="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2242r3.html">P2242</A>
(Non-literal variables (and labels and gotos) in constexpr functions)
added 7.7 [<A href="https://wg21.link/expr.const#5.2">expr.const</A>] bullet 5.2:</P>

<BLOCKQUOTE>

<UL>
<LI>
a control flow that passes through a declaration of a variable with
static (6.7.5.2 [<A href="https://wg21.link/basic.stc.static">basic.stc.static</A>]) or thread
(6.7.5.3 [<A href="https://wg21.link/basic.stc.thread">basic.stc.thread</A>]) storage duration;
</LI>
</UL>

</BLOCKQUOTE>

<P>It seems that block-scope extern (i.e. non-defining) declarations
are covered by the above bullet, but only definitions should be in
view here.</P>

<P><U>Suggested resolution:</U></P>

<OL>
<LI>

<P>Change in 7.7 [<A href="https://wg21.link/expr.const#5.2">expr.const</A>] bullet 5.2 as follows:</P>

<BLOCKQUOTE>

<UL>
<LI>
a control flow that passes through a <DEL>declaration</DEL>
<INS>definition</INS> of a variable with static
(6.7.5.2 [<A href="https://wg21.link/basic.stc.static">basic.stc.static</A>]) or thread
(6.7.5.3 [<A href="https://wg21.link/basic.stc.thread">basic.stc.thread</A>]) storage duration;
</LI>
</UL>

</BLOCKQUOTE>
</LI>

<LI>
<P>Change in 8.8 [<A href="https://wg21.link/stmt.dcl#3">stmt.dcl</A>] paragraph 3 as follows:</P>

<BLOCKQUOTE>

Dynamic initialization of a block variable with static storage
duration (6.7.5.2 [<A href="https://wg21.link/basic.stc.static">basic.stc.static</A>]) or thread storage duration
(6.7.5.3 [<A href="https://wg21.link/basic.stc.thread">basic.stc.thread</A>]) is performed the first time control
passes through its <DEL>declaration</DEL> <INS>definition</INS>; such
a variable is considered initialized upon the completion of its
initialization. If the initialization exits by throwing an exception,
the initialization is not complete, so it will be tried again the next
time control enters the <DEL>declaration</DEL> <INS>definition</INS>.
If control enters the declaration concurrently while the variable is
being initialized, the concurrent execution shall wait for completion
of the initialization.  [<I>Note:</I> ...  &#8212;<I>end note</I>] If
control re-enters the <DEL>declaration</DEL> <INS>definition</INS>
recursively while the variable is being initialized, the behavior is
undefined.

</BLOCKQUOTE>
</LI>

</OL>

<BR><BR>
</BODY>
</HTML>
